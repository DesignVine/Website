<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>DesignVine</title>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="/homepage.css" rel="stylesheet" />
        <link rel="stylesheet" href="/style.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">

        <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>

        <link rel="icon" type="image/x-icon" href="/assets/favicon.png">
    </head>
    <body id="page-top">
        <!-- Navigation-->
        <div >
        <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
            <div class="container px-4 px-lg-5">
                <a style="color:black;"class="navbar-brand" href="/">DesignVine</a>
                <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul  class="navbar-nav ms-auto">
                        <li class="nav-item"><a style="color:black;" class="nav-link" href="/users/settings">Settings</a></li>
                        <li class="nav-item"><a style="color:black;" class="nav-link" href="/users/logout">Logout</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        </div>
        <!-- Projects-->
        <section class="projects-section bg-light" id="projects">
            <div class="row mx-auto">
                <div class="column left " name = "customers">
                    <h3 style="margin-left:15%;" >Customers</h3>
                    <table id="customerTable" style="margin-left:18%; color: #1eaedb" >
                        <% if (typeof customers != 'undefined') { %>
                            <% customers.forEach(customer =>{%>
                                    <tr>
                                        <td>
                                            <a href="/project/<%= customer.project_id %>/<%= user_id %>">&nbsp;<%= customer.firstname %>&nbsp;<%= customer.lastname %></a>
                                            <!-- Dropdown Menu -->
                                            <div class="dropdown">
                                                <i class="fa fa-ellipsis-h" aria-hidden="true" data-bs-toggle="dropdown"></i>
                                                <ul class="dropdown-menu">
                                                    <li><a class="dropdown-item delete-icon" href="#" id ="<%= customer.project_id %>">Permanently Delete</a></li>
                                                    <li><a class="dropdown-item" href="#">Archive</a></li>
                                                    <li><a class="dropdown-item" href="#">Star</a></li>
                                                </ul>
                                            </div>
                                        </td>
                                    </tr>
                            <% }) %>
                        <%} %>
                    </table>
                    
                </div>
    
                <div class="column right" name="add customer">
                    <div class="addCustomerForm" style="margin-left:15%">
                    <ul style="text-align:center;">
                        <% if (typeof errors != 'undefined') { %>
                            <% errors.forEach(error =>{%>
                                <li><%= error.message %></li>
                            <% }) %>
                        <%} %>
                    </ul>
                    <h3 >New Project</h3>
                    <form style="text-align: left;" enctype="multipart/form-data" action="/users/dashboard" method ="POST">
                        <div>
                            <input type="text" id ="firstname" name = "firstname" placeholder = "Customer First Name" required /> *
                        </div>
                        <br>

                        <div>
                            <input type="text" id ="lastname" name = "lastname" placeholder = "Customer Last Name" required /> *
                        </div>

                        <br>

                        <div>
                            <input type="email" id ="email" name = "email" placeholder = "Customer E-Mail" />
                        </div>
                        <br>
                        <div>
                            <textarea id="description" name="description" rows="3" cols="30" style="width: auto;" maxlength="250" placeholder="Project Description"></textarea>
                        </div>
                        <br/>

                        <div class="drop-zone">
                            <span class="drop-zone__prompt">Drop files here or click to upload</span>
                            <input type="file" name="files" class="drop-zone__input" multiple>
                        </div>
                        <br/>
                        <div>
                            <input type="submit" value ="Add Customer"/>
                        </div>
                    </form>
                    </div>
                </div>
            </div>
            <style>
                .dataTables_length,  /* Hide 'show x entries' dropdown */
                .dataTables_filter,  /* Hide search box */
                .dataTables_info,    /* Hide 'showing x to y of z' info */
                .dataTables_paginate /* Hide pagination controls */
                {
                    display: none !important;

                }
                #customerTable,              /* The table itself */
                #customerTable thead,        /* Header section */
                #customerTable tbody,        /* Body section */
                #customerTable tr,           /* Each row */
                #customerTable td,           /* Each data cell */
                #customerTable th            /* Each header cell */
                {
                    background-color: inherit;  /* Take the color from the parent */
                    border: none !important;  /* Remove the borders */

                }
                
            </style>
            
            <script>

                $(document).ready(function() {
                    $('#customerTable').DataTable({
                        "paging": false,         // Disable pagination
                        "info": false,           // Disable showing "Showing x to y of z entries"
                        "searching": false,      // Disable the search box
                        "columnDefs": [
                            { "orderable": true, "targets": [0] }  // 0 represents the first column
                        ]
                    });
                });



                document.querySelectorAll(".drop-zone__input").forEach((inputElement) => {
                    const dropZoneElement = inputElement.closest(".drop-zone");
    
                    dropZoneElement.addEventListener("click", (e) => {
                        inputElement.click();
                    });
    
                    inputElement.addEventListener("change", (e) => {
                        if (inputElement.files.length) {
                            updateThumbnail(dropZoneElement, inputElement.files[0]);
                        }
                    });
    
                    dropZoneElement.addEventListener("dragover", (e) => {
                        e.preventDefault();
                        dropZoneElement.classList.add("drop-zone--over");
                    });
    
                    ["dragleave", "dragend"].forEach((type) => {
                        dropZoneElement.addEventListener(type, (e) => {
                            dropZoneElement.classList.remove("drop-zone--over");
                        });
                    });
    
                    dropZoneElement.addEventListener("drop", (e) => {
                        e.preventDefault();
    
                        if (e.dataTransfer.files.length) {
                            inputElement.files = e.dataTransfer.files;
                            updateThumbnail(dropZoneElement, e.dataTransfer.files[0]);
                        }
    
                        dropZoneElement.classList.remove("drop-zone--over");
                    });
                });
    
                /**
                 * Updates the thumbnail on a drop zone element.
                 *
                 * @param {HTMLElement} dropZoneElement
                 * @param {File} file
                 */
                function updateThumbnail(dropZoneElement, file) {
                    let thumbnailElement = dropZoneElement.querySelector(".drop-zone__thumb");
    
                    // First time - remove the prompt
                    if (dropZoneElement.querySelector(".drop-zone__prompt")) {
                        dropZoneElement.querySelector(".drop-zone__prompt").remove();
                    }
    
                    // First time - there is no thumbnail element, so lets create it
                    if (!thumbnailElement) {
                        thumbnailElement = document.createElement("div");
                        thumbnailElement.classList.add("drop-zone__thumb");
                        dropZoneElement.appendChild(thumbnailElement);
                    }
    
                    thumbnailElement.dataset.label = file.name;
    
                    // Show thumbnail for image files
                    if (file.type.startsWith("image/")) {
                        const reader = new FileReader();
    
                        reader.readAsDataURL(file);
                        reader.onload = () => {
                            thumbnailElement.style.backgroundImage = `url('${reader.result}')`;
                        };
                    } else {
                        thumbnailElement.style.backgroundImage = null;
                    }
                }
            </script>
            <script>
                // Get all delete icons
                const deleteIcons = document.querySelectorAll('.delete-icon');
              
                // Add click event listener to each delete icon
                deleteIcons.forEach(deleteIcon => {
                  deleteIcon.addEventListener('click', function() {
                    const projectId = deleteIcon.getAttribute('id');
                    
                    // Display confirmation dialog
                    const result = confirm('Are you sure you want to delete this project?');
                    
                    // If user confirms, execute the delete route
                    if (result) {
                      fetch(`/delete-project/${projectId}`, {
                        method: 'DELETE'
                      })
                      .then(response => {
                        if (response.ok) {
                            window.location.reload();
    
                          // You can add additional code here to update the UI as needed
                        } else {
                          alert('Failed to delete the project. Please try again.');
                        }
                      })
                      .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred while deleting the project. Please try again.');
                      });
                    }
                  });
                });
              </script>
        </section>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
        <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
        <!-- * *                               SB Forms JS                               * *-->
        <!-- * * Activate your form at https://startbootstrap.com/solution/contact-forms * *-->
        <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
        <script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
    </body>
</html>